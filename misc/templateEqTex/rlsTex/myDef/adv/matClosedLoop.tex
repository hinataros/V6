\NewDocumentCommand\matClosedLoop{m o o o o o}
{
  \ifthenelse{\equal{exp}{#2}}
  {
    \twoB{#1}{}{c}{m}[exp][#3][#4][#5]
  }
  {
    \twoB{#1}{#2}{#2_f}{#2_m}[#3][#4][#5][#6]
  }
}

\NewDocumentCommand\twoB{m m m m o o o o}
{
  \ifthenelse{\equal{exp}{#5}}
  {
    \ifthenelse{\equal{r}{#6} \OR \equal{l}{#6}}
    {
      \ifthenelse{\equal{r}{#6}}
      {
        \IfValueTF{#8}
        {
          \bbmat{
            \notation{#1}[][#3][#7]#8\\
            \notation{#1}[][#4][#7]#8
          }
        }
        {
          \bbmat{
            \notation{#1}[][#3][#7]\\
            \notation{#1}[][#4][#7]
          }
        }
      }
      {
        \IfValueTF{#8}
        {
          \bbmat{
            \notation{#1}[][#3][#7]#8 & \notation{#1}[][#4][#7]#8\\
          }
        }
        {
          \bbmat{
            \notation{#1}[][#3][#7] & \notation{#1}[][#4][#7]\\
          }
        }
      }
    }
    {
      error
    }
  }
  {
    \IfValueTF{#5}
    {
      \ifthenelse{\NOT \equal{}{#5}}
      {
        \notation{#1}[][#2_#5]
      }
      {
        \notation{#1}[][#2]
      }
    }
    {
      \notation{#1}[][#2]
    }
  }
}
