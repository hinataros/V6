# @author Sho Miyahara 2018

angle unit: degree

controller:
  control model: skeletonA4
  input: torque
  driven: mix
  trigger: check contact

  default:
    control method:
      inverse dynamics controller: fullDynamicsController
      operational space controller: decomposeEndEffectorAcceleration
      motion controller: mixedGeneralizedMomentum
      force controller: centroidalEcmpDistribution
      momentum controller: centroidalVrpMomentum
      torque controller: mixedOpt
      # motion controller: mBADM
      # motion controller: mBADistM
      # motion controller: mGDAM
      # motion controller: mRAA
      # momentum controller: centroidalVrpMomentumDamping
      # momentum controller: centroidalVrpRNS


    desired value generator:
      DCM: {name: HTWalking}
      base rotation: {name: CP}
      control node translation:
        RLEGEE: {name: swing}
        LLEGEE: {name: swing}

    # feedback controller:
    #   CoM: dcmControl

    KX: 3.e+2
    OB: &OBH 3.e+1
    wB: &wBH 5.e+1
    # OB: &OBL 0
    # wB: &wBL 0
    OB: &OBL 3.e+1
    wB: &wBL 5.e+1

    KpwB: *OBH
    KdwB: *wBH

    Kpv:
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
    Kpw:
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
    Kdv:
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1
    Kdw:
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1

    kDth: &kDthH 1.e+2
    kthHinit: &kthHinit 1.e+2
    # KDlC: 100

    KDth:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kDthH, *kDthH, *kDthH, *kDthH,
      *kDthH, *kDthH, *kDthH, *kDthH]
    Kthinit:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kthHinit, *kthHinit, *kthHinit, *kthHinit,
      *kthHinit, *kthHinit, *kthHinit, *kthHinit]

    kDdth: &kDdthH 100
    KDdthH:
      [0. ,0. ,0. ,0. ,0. ,0. ,
      0. ,0. ,0. ,0. ,0. ,0. ,
      *kDdthH, *kDdthH, *kDdthH, *kDdthH,
      *kDdthH, *kDdthH, *kDdthH, *kDdthH]

    Bc: &ds
      RLEGEE: [1, 1, 1, 1, 1, 1]
      LLEGEE: [1, 1, 1, 1, 1, 1]
    Bm: &zs
      RLEGEE: [0, 0, 0, 0, 0, 0]
      LLEGEE: [0, 0, 0, 0, 0, 0]


    BwB: [1, 1, 1]
    BLC: [1, 1, 1, 0, 0, 0]
    BwC: [0, 0, 0]

  state:
    -
      control method:
        inverse dynamics controller: default
      Bc: *zs
      Bm: *zs
    -
      control method:
        inverse dynamics controller: fullDynamicsController

      Bc: *ds
      Bm: *zs

    -
      control method:
        inverse dynamics controller: fullDynamicsController
      Bc: &ls
        RLEGEE: [0, 0, 0, 0, 0, 0]
        LLEGEE: [1, 1, 1, 1, 1, 1]
      Bm: &rs
        RLEGEE: [1, 1, 1, 1, 1, 1]
        LLEGEE: [0, 0, 0, 0, 0, 0]
    -
      control method:
        inverse dynamics controller: fullDynamicsController
      Bc: *rs
      Bm: *ls

  walking:
    height: &height 0.02

    # length: &steplength1 0.105
    # length: &steplength2 0.210
    # length: &steplength3 0.315
    # length: &steplength4 0.420
    # length: &steplength5 0.525
    # length: &steplength6 0.630
    # length: &steplength7 0.735
    length: &steplength1 0.08
    length: &steplength2 0.16
    length: &steplength3 0.24
    length: &steplength4 0.32
    length: &steplength5 0.40
    length: &steplength6 0.48
    length: &steplength7 0.56

    vrp waypoint:
      - [0., -0.039, 0.]
      - [*steplength1, 0.039, 0.]
      - [*steplength2, -0.039, 0.]
      - [*steplength3, 0.039, 0.]
      - [*steplength4, -0.039, 0.]
      - [*steplength5, 0.039, 0.]
      - [*steplength6, -0.039, 0.]
      - [*steplength7, 0.039, 0.]
      - [*steplength7, 0., 0.]

    # dtstep: .6
    # dtDSstep: &tds 0.2
    #
    # twf: &tinitial 0.4
    # twf: &tswingleg 0.4
    dtstep: .5
    dtDSstep: &tds 0.1

    twf: &tinitial 0.3
    twf: &tswingleg 0.4
    # dtstep: .4
    # dtDSstep: &tds 0.1
    #
    # twf: &tinitial 0.25
    # twf: &tswingleg 0.3

    alphaDSstep: 0.5
    alphaHTstep: 0.5
    offset: 0.01
    toe: 0.025
    heel: -0.015

    tstab: &tstab 1.

  swing leg:
    rfabs: &swingLeg1
      LLEGEE: [*steplength1, 0.039, *height]
    rfabs: &swingLeg2
      RLEGEE: [*steplength2, -0.039, *height]
    rfabs: &swingLeg3
      LLEGEE: [*steplength3, 0.039, *height]
    rfabs: &swingLeg4
      RLEGEE: [*steplength4, -0.039, *height]
    rfabs: &swingLeg5
      LLEGEE: [*steplength5, 0.039, *height]
    rfabs: &swingLeg6
      RLEGEE: [*steplength6, -0.039, *height]
    rfabs: &swingLeg7
      LLEGEE: [*steplength7, 0.039, *height]
    rfabs: &swingLeg8
      RLEGEE: [*steplength7, -0.039, *height]

  sequence:
    -
      twf: *tstab
    -
      twf: *tinitial
    # 1 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rfabs: *swingLeg1

      KpwB: *OBL
      KdwB: *wBL

    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH

    # 2 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rfabs: *swingLeg2

      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 3 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rfabs: *swingLeg3

      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 4 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rfabs: *swingLeg4

      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 5 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rfabs: *swingLeg5

      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 6 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rfabs: *swingLeg6

      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 7 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rfabs: *swingLeg7

      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 8 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rfabs: *swingLeg8

      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH


    # -
    #   twf: 10.
    #   control method:
    #     motion controller: mixedGeneralizedMomentum
    #     momentum controller: centroidalVrpMomentum
    #
    #   KpwB: *OBH
    #   KdwB: *wBH
    #   xiBf: [0., 0., 0.]
