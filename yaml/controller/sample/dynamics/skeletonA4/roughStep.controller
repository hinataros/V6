# @author Sho Miyahara 2018

angle unit: degree

controller:
  control model: skeletonA4
  input: torque
  driven: mix
  trigger: check contact

  default:
    control method:
      inverse dynamics controller: fullDynamicsController
      operational space controller: decomposeEndEffectorAcceleration
      motion controller: mixedGeneralizedMomentum
      # force controller: centroidalEcmpDistribution
      force controller: CRBWCbaseDistribution
      momentum controller: centroidalVrpMomentum
      torque controller: mixedOpt
      # momentum controller: centroidalVrpMomentumDamping


    desired value generator:
      DCM: {name: VRPWalking}
      base rotation: {name: CP}
      control node translation:
        RLEGEE: {name: swingabs, cur: true}
        LLEGEE: {name: swingabs, cur: true}
      control node rotation:
        RLEGEE: {name: CP}
        LLEGEE: {name: CP}

    # feedback controller:
    #   CoM: dcmControl

    KX: 3.e+2
    OB: &OBH 3.e+1
    wB: &wBH 5.e+1
    # OB: &OBL 0
    # wB: &wBL 0
    OB: &OBL 3.e+1
    wB: &wBL 5.e+1

    KpwB: *OBH
    KdwB: *wBH

    Kpv:
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
    Kpw:
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
    Kdv:
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1
    Kdw:
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1

    kDth: &kDthH 1.e+2
    kthHinit: &kthHinit 1.e+2

    KDth:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kDthH, *kDthH, *kDthH, *kDthH,
      *kDthH, *kDthH, *kDthH, *kDthH]
    Kthinit:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kthHinit, *kthHinit, *kthHinit, *kthHinit,
      *kthHinit, *kthHinit, *kthHinit, *kthHinit]

    kDdth: &kDdthH 100
    KDdthH:
      [0. ,0. ,0. ,0. ,0. ,0. ,
      0. ,0. ,0. ,0. ,0. ,0. ,
      *kDdthH, *kDdthH, *kDdthH, *kDdthH,
      *kDdthH, *kDdthH, *kDdthH, *kDdthH]

    Bc: &ds
      RLEGEE: [1, 1, 1, 1, 1, 1]
      LLEGEE: [1, 1, 1, 1, 1, 1]
    Bm: &zs
      RLEGEE: [0, 0, 0, 0, 0, 0]
      LLEGEE: [0, 0, 0, 0, 0, 0]

  state:
    -
      control method:
        inverse dynamics controller: default
      Bc: *zs
      Bm: *zs
    -
      control method:
        inverse dynamics controller: fullDynamicsController

      Bc: *ds
      Bm: *zs

    -
      control method:
        inverse dynamics controller: fullDynamicsController
      Bc: &ls
        RLEGEE: [0, 0, 0, 0, 0, 0]
        LLEGEE: [1, 1, 1, 1, 1, 1]
      Bm: &rs
        RLEGEE: [1, 1, 1, 1, 1, 1]
        LLEGEE: [0, 0, 0, 0, 0, 0]
    -
      control method:
        inverse dynamics controller: fullDynamicsController
      Bc: *rs
      Bm: *ls

  walking:
    length: &steplength1 0.08
    length: &steplength2 0.16
    length: &steplength3 0.24
    length: &steplength4 0.32
    length: &steplength5 0.40
    length: &steplength6 0.48
    length: &steplength7 0.56
    length: &steplength8 0.64
    length: &steplength9 0.72
    length: &steplength10 0.80
    length: &steplength11 0.88
    length: &steplength12 0.96
    length: &steplength13 1.04
    length: &steplength14 1.12
    length: &steplength15 1.20

    vrp waypoint:
      - [0., -0.039, 0.]
      - [*steplength1, 0.039, 0.]
      - [*steplength2, -0.039, 0.02]
      - [*steplength3, 0.039, 0.04]
      - [*steplength4, -0.039, 0.06]
      - [*steplength5, 0.039, 0.08]
      - [*steplength6, -0.039, 0.10]
      - [*steplength7, 0.039, 0.12]
      - [*steplength8, -0.039, 0.12]
      - [*steplength9, 0.039, 0.10]
      - [*steplength10, -0.039, 0.08]
      - [*steplength11, 0.039, 0.06]
      - [*steplength12, -0.039, 0.04]
      - [*steplength13, 0.039, 0.02]
      - [*steplength14, -0.039, 0.]
      - [*steplength15, 0.039, 0.]
      - [*steplength15, 0., 0.]

    dtstep: &tss 1.
    dtDSstep: &tds 0.2

    twf: &tswingleg 0.8


    alphaDSstep: 0.5
    alphaHTstep: 0.5
    offset: 0.01
    toe: 0.025
    heel: -0.015

    tstab: &tstab 1.

    swing leg:
      rfabs: &swingLeg1
        LLEGEE: [*steplength1, 0.039, -0.0002]
      rfabs: &swingLeg2
        RLEGEE: [*steplength2, -0.039, 0.02]
      rfabs: &swingLeg3
        LLEGEE: [*steplength3, 0.039, 0.0398]
      rfabs: &swingLeg4
        RLEGEE: [*steplength4, -0.039, 0.06]
      rfabs: &swingLeg5
        LLEGEE: [*steplength5, 0.039, 0.08]
      rfabs: &swingLeg6
        RLEGEE: [*steplength6, -0.039, 0.1]
      rfabs: &swingLeg7
        LLEGEE: [*steplength7, 0.039, 0.12]
      rfabs: &swingLeg8
        RLEGEE: [*steplength8, -0.039, 0.12]
      rfabs: &swingLeg9
        LLEGEE: [*steplength9, 0.039, 0.0998]
      rfabs: &swingLeg10
        RLEGEE: [*steplength10, -0.039, 0.07995]
      rfabs: &swingLeg11
        LLEGEE: [*steplength11, 0.039, 0.0599]
      rfabs: &swingLeg12
        RLEGEE: [*steplength12, -0.039, 0.03995]
      rfabs: &swingLeg13
        LLEGEE: [*steplength13, 0.039, 0.0199]
      rfabs: &swingLeg14
        RLEGEE: [*steplength14, -0.039, -0.0002]
      rfabs: &swingLeg15
        LLEGEE: [*steplength15, 0.039, -0.0002]
      rfabs: &swingLeg16
        RLEGEE: [*steplength15, -0.039, -0.0002]

      xif: &xiLeg1
        LLEGEE: [0., 0., 0.]
      xif: &xiLeg2
        RLEGEE: [0., 0., 0.]
      xif: &xiLeg3
        LLEGEE: [0., 0., 0.]
      xif: &xiLeg4
        RLEGEE: [0., 0., -15.]
      xif: &xiLeg5
        LLEGEE: [0., 0., 0.]
      xif: &xiLeg6
        RLEGEE: [0., 0., 15.]
      xif: &xiLeg7
        LLEGEE: [0., -15., 0.]
      xif: &xiLeg8
        RLEGEE: [0., 0., 0.]
      xif: &xiLeg9
        LLEGEE: [0., 0., 0.]
      xif: &xiLeg10
        RLEGEE: [0., 15., 0.]
      xif: &xiLeg11
        LLEGEE: [0., -15., 0.]
      xif: &xiLeg12
        RLEGEE: [0., 0., 0.]
      xif: &xiLeg13
        LLEGEE: [0., 0., 0.]
      xif: &xiLeg14
        RLEGEE: [0., 0., 0.]
      xif: &xiLeg15
        LLEGEE: [0., 0., 0.]
      xif: &xiLeg16
        RLEGEE: [0., 0., 0.]

      rApex: &rap1
        LLEGEE: 0.02
      rApex: &rap2
        RLEGEE: 0.03
      rApex: &rap3
        LLEGEE: 0.05
      rApex: &rap4
        RLEGEE: 0.078
      rApex: &rap5
        LLEGEE: 0.09
      rApex: &rap6
        RLEGEE: 0.125
      rApex: &rap7
        LLEGEE: 0.13
      rApex: &rap8
        RLEGEE: 0.135
      rApex: &rap9
        LLEGEE: 0.147
      rApex: &rap10
        RLEGEE: 0.14
      rApex: &rap11
        LLEGEE: 0.11
      rApex: &rap12
        RLEGEE: 0.09
      rApex: &rap13
        LLEGEE: 0.09
      rApex: &rap14
        RLEGEE: 0.05
      rApex: &rap15
        LLEGEE: 0.03
      rApex: &rap16
        RLEGEE: 0.02

  sequence:
    -
      twf: *tstab
    -
      twf: *tss
    # 1 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rApex: *rap1
      rfabs: *swingLeg1
      xif: *xiLeg1
      KpwB: *OBL
      KdwB: *wBL

    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH

    # 2 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rApex: *rap2
      rfabs: *swingLeg2
      xif: *xiLeg2
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 3 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rApex: *rap3
      rfabs: *swingLeg3
      xif: *xiLeg3
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 4 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rApex: *rap4
      rfabs: *swingLeg4
      xif: *xiLeg4
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 5 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rApex: *rap5
      rfabs: *swingLeg5
      xif: *xiLeg5
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 6 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rApex: *rap6
      rfabs: *swingLeg6
      xif: *xiLeg6
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 7 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rApex: *rap7
      rfabs: *swingLeg7
      xif: *xiLeg7
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 8 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rApex: *rap8
      rfabs: *swingLeg8
      xif: *xiLeg8
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 9 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rApex: *rap9
      rfabs: *swingLeg9
      xif: *xiLeg9
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 10 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rApex: *rap10
      rfabs: *swingLeg10
      xif: *xiLeg10
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 11 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rApex: *rap11
      rfabs: *swingLeg11
      xif: *xiLeg11
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 12 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rApex: *rap12
      rfabs: *swingLeg12
      xif: *xiLeg12
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 13 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rApex: *rap13
      rfabs: *swingLeg13
      xif: *xiLeg13
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 14 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rApex: *rap14
      rfabs: *swingLeg14
      xif: *xiLeg14
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 15 step
    -
      twf: *tswingleg
      Bc: *rs
      Bm: *ls
      rApex: *rap15
      rfabs: *swingLeg15
      xif: *xiLeg15
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH
    # 16 step
    -
      twf: *tswingleg
      Bc: *ls
      Bm: *rs
      rApex: *rap16
      rfabs: *swingLeg16
      xif: *xiLeg16
      KpwB: *OBL
      KdwB: *wBL
    -
      twf: *tds
      KpwB: *OBH
      KdwB: *wBH

    -
      twf: 100.
