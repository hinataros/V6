# @author Sho Miyahara 2018

angle unit: degree

controller:
  control model: skeletonA4
  input: torque

  default:
    control method:
      inverse dynamics controller: fullDynamicsController
      operational space controller: decomposeEndEffectorAcceleration
      motion controller: mixedGeneralizedMomentum
      # motion controller: mGDAM
      force controller: centroidalEcmpDistribution
      momentum controller: centroidalVrpMomentum
      # momentum controller: centroidalMomentum
      torque controller: mixedOpt

    desired value generator:
      DCM: {name: CPabs}
      # DCM: {name: HTWalking}
      # CoM: {name: HTWalking}
      base rotation: {name: CP}
      control node translation:
        RLEGEE: {name: swing}
        LLEGEE: {name: swing}
        RARMEE: {name: CP}
        LARMEE: {name: CP}
      control node rotation:
        RLEGEE: {name: CP}
        LLEGEE: {name: CP}

    # feedback controller:
    #   CoM: dcmControl

    KX: 3.e+2
    KpC: 3.e+2
    KdC: 5.e+1
    KpwB: 3.e+2
    KdwB: 5.e+1

    Kpv:
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
      RARMEE: 3.e+2
      LARMEE: 3.e+2
    Kpw:
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
    Kdv:
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1
      RARMEE: 5.e+1
      LARMEE: 5.e+1
    Kdw:
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1

    kDth: &kDthH 1.e+2
    kthHinit: &kthHinit 1.e+2

    KDth:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kDthH, *kDthH, *kDthH, *kDthH,
      *kDthH, *kDthH, *kDthH, *kDthH]
    Kthinit:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kthHinit, *kthHinit, *kthHinit, *kthHinit,
      *kthHinit, *kthHinit, *kthHinit, *kthHinit]

    Bc: &ds
      RLEGEE: [1, 1, 1, 1, 1, 1]
      LLEGEE: [1, 1, 1, 1, 1, 1]
    Bm: &zs
      RLEGEE: [0, 0, 0, 0, 0, 0]
      LLEGEE: [0, 0, 0, 0, 0, 0]

    BwB: [1, 1, 1]
    BLC: [1, 1, 1, 0, 0, 1]

    # for walking
    height: &height 0.02
    rApex:
      RLEGEE: *height
      LLEGEE: *height

    length: &steplength1 0.08
    length: &steplength2 0.16
    length: &steplength3 0.24

    swing leg:
      rf: &swingLeg0
        RLEGEE: [0., 0., 0.]
      rf: &swingLeg1
        LLEGEE: [*steplength1, 0., 0.]
      rf: &swingLeg2
        RLEGEE: [*steplength2, 0., 0.]
      rf: &swingLeg3
        LLEGEE: [*steplength3, 0., 0.]
      rf: &swingLeg4
        RLEGEE: [*steplength3, 0., 0.]



  test: HEAD
  state:
    -
      test: state0
      trigger: check contact
      state:
        -
          test: state0-0
          control method:
            inverse dynamics controller: default
          Bc: *zs
          Bm: *zs
        -
          test: state0-1
          control method:
            inverse dynamics controller: fullDynamicsController

          Bc: *ds
          Bm: *zs

        -
          test: state0-2
          control method:
            inverse dynamics controller: fullDynamicsController
          Bc: &ls
            RLEGEE: [0, 0, 0, 0, 0, 0]
            LLEGEE: [1, 1, 1, 1, 1, 1]
          Bm: &rs
            RLEGEE: [1, 1, 1, 1, 1, 1]
            LLEGEE: [0, 0, 0, 0, 0, 0]
        -
          test: state0-3
          control method:
            inverse dynamics controller: fullDynamicsController
          Bc: *rs
          Bm: *ls
        -
          test: state0-4
          control method:
            inverse dynamics controller: fullDynamicsController
          Bc: *ds
          Bm: *zs
        -
          test: state0-5
          control method:
            inverse dynamics controller: fullDynamicsController
          Bc: *ls
          Bm: *rs
        -
          test: state0-6
          control method:
            inverse dynamics controller: fullDynamicsController
          Bc: *rs
          Bm: *ls

    -
      test: state1
      trigger: continuous sequence
      state:
        -
          test: state1-0 & seq0

          sequence:
            -
              twf: 1.
            -
              twf: 1.
              rXfabs: [0., 0., 0.]
            -
              twf: 1.

        -
          test: state1-1 & seq1
          reset: true
          jump: 2

          walking:
            ipDim: 2
            tstab: &tstab 0.5

            dtstep: &tss 0.5
            dtDSstep: &tds 0.2

            twf: &tswingleg 0.3 # tss - tds

            alphaDSstep: 0.5
            alphaHTstep: 0.5
            offset: 0.01 # fist step: right -> +
            toe: 0.025
            heel: -0.015

          sequence:
            -
              test: seq0-0
              twf: *tstab
              control method:
                momentum controller: centroidalVrpMomentum

              desired value generator:
                CoM: {name: HTWalking}
            -
              test: seq0-1
              twf: *tss
              rf: *swingLeg0 # for vrp way point calculation
            # 1 step
            -
              test: seq0-2
              twf: *tswingleg
              Bc: *rs
              Bm: *ls
              rf: *swingLeg1
            -
              test: seq0-3
              twf: *tds
            # 2 step
            -
              test: seq0-4
              twf: *tswingleg
              Bc: *ls
              Bm: *rs
              rf: *swingLeg2
            -
              test: seq0-5
              twf: *tds
            # 3 step
            -
              test: seq0-6
              twf: *tswingleg
              Bc: *rs
              Bm: *ls
              rf: *swingLeg3
            -
              test: seq0-7
              twf: *tds
            # 4 step
            -
              test: seq0-8
              twf: *tswingleg
              Bc: *ls
              Bm: *rs
              rXf: [*steplength3, 0., 0.] # for vwp calc
              rf: *swingLeg4
            -
              test: seq0-9
              twf: *tds
            -
              test: seq0-10
              twf: 1.
              control method:
                momentum controller: centroidalVrpMomentum

        -
          test: state1-2 & seq2
          reset: true
          jump: 1

          sequence:
            -
              test: seq1-0
              twf: 1.
              desired value generator:
                DCM: {name: CP}
                CoM: {name: CP}
              Bm:
                RARMEE: [1, 1, 1, 0 ,0 ,0]
              rf:
                RARMEE: [0.1, 0., 0.1]
            -
              test: seq1-1
              twf: 1.
              # rf:
              #   RARMEE: [0., 0., 0.]
            -
              test: seq1-2
              twf: 1.
              rf:
                RARMEE: [0.1, 0., 0.1]
            -
              test: seq1-3
              twf: 1.
              rf:
                RARMEE: [0., 0., 0.]
            -
              test: seq1-4
              twf: 1.
              Bm:
                RARMEE: [0, 0, 0, 0 ,0 ,0]
