# @author Sho Miyahara 2018

angle unit: degree

controller:
  control model: skeletonA4
  input: torque
  driven: mix

  default:
    control method:
      inverse dynamics controller: fullDynamicsController
      operational space controller: decomposeEndEffectorAcceleration
      motion controller: mixedGeneralizedMomentum
      # motion controller: mGDAM
      force controller: centroidalEcmpDistribution
      momentum controller: centroidalVrpMomentum
      # momentum controller: centroidalMomentum
      torque controller: mixedOpt

    desired value generator:
      # DCM: {name: HTWalking}
      CoM: {name: HTWalking}
      base rotation: {name: CP}
      control node translation:
        RLEGEE: {name: swingabs}
        LLEGEE: {name: swingabs}
      # control node rotation:
      #   RLEGEE: {name: CPabs}
      #   LLEGEE: {name: CPabs}

    feedback controller:
      CoM: dcmControl

    KX: 3.e+2
    KpC: 3.e+2
    KdC: 5.e+1
    KpwB: 3.e+2
    KdwB: 5.e+1

    Kpv:
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
    Kpw:
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
    Kdv:
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1
    Kdw:
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1

    kDth: &kDthH 1.e+2
    kthHinit: &kthHinit 1.e+2

    KDth:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kDthH, *kDthH, *kDthH, *kDthH,
      *kDthH, *kDthH, *kDthH, *kDthH]
    Kthinit:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kthHinit, *kthHinit, *kthHinit, *kthHinit,
      *kthHinit, *kthHinit, *kthHinit, *kthHinit]

    Bc: &ds
      RLEGEE: [1, 1, 1, 1, 1, 1]
      LLEGEE: [1, 1, 1, 1, 1, 1]
    Bm: &zs
      RLEGEE: [0, 0, 0, 0, 0, 0]
      LLEGEE: [0, 0, 0, 0, 0, 0]

    BwB: [1, 1, 1]
    BLC: [1, 1, 1, 0, 0, 1]

    # for walking
    height: &height 0.02
    rApex:
      RLEGEE: *height
      LLEGEE: *height

    # distribution offset: [0., 0.]

  state:
    -
      trigger: check contact
      state:
        -
          control method:
            inverse dynamics controller: default
          Bc: *zs
          Bm: *zs
        -
          control method:
            inverse dynamics controller: fullDynamicsController

          Bc: *ds
          Bm: *zs

        -
          control method:
            inverse dynamics controller: fullDynamicsController
          Bc: &ls
            RLEGEE: [0, 0, 0, 0, 0, 0]
            LLEGEE: [1, 1, 1, 1, 1, 1]
          Bm: &rs
            RLEGEE: [1, 1, 1, 1, 1, 1]
            LLEGEE: [0, 0, 0, 0, 0, 0]
        -
          control method:
            inverse dynamics controller: fullDynamicsController
          Bc: *rs
          Bm: *ls
    -
      walking:
        height: &height 0.02
        # oscillation: 0.023

        ipDim: 2

        length: &steplength1 0.08
        length: &steplength2 0.16
        length: &steplength3 0.24
        # length: &steplength1 0.1
        # length: &steplength2 0.2
        # length: &steplength3 0.3

        vrp waypoint:
          - [0., -0.039, 0.]
          - [*steplength1, 0.039, 0.]
          - [*steplength2, -0.039, 0.]
          - [*steplength3, 0.039, 0.]
          - [*steplength3, 0., 0.]

        # dtstep: .5
        # dtDSstep: &tds 0.2
        #
        # twf: &tinitial 0.35
        # twf: &tswingleg 0.3

        dtstep: &tss 0.5
        dtDSstep: &tds 0.2

        # twf: &tinitial 0.5
        twf: &tswingleg 0.3 # tss - tds


        alphaDSstep: 0.5
        alphaHTstep: 0.5
        offset: 0.01
        # offset: 0.025
        toe: 0.025
        heel: -0.015


        tstab: &tstab 1.

        swing leg:
          rfabs: &swingLeg1
            LLEGEE: [*steplength1, 0.039, 0.]
          rfabs: &swingLeg2
            RLEGEE: [*steplength2, -0.039, 0.]
          rfabs: &swingLeg3
            LLEGEE: [*steplength3, 0.039, 0.]
          rfabs: &swingLeg4
            RLEGEE: [*steplength3, -0.039, 0.]

      sequence:
        -
          twf: *tstab
        -
          twf: *tss
        # 1 step
        -
          twf: *tswingleg
          Bc: *rs
          Bm: *ls
          rfabs: *swingLeg1
        -
          twf: *tds
        # 2 step
        -
          twf: *tswingleg
          Bc: *ls
          Bm: *rs
          rfabs: *swingLeg2
        -
          twf: *tds
        # 3 step
        -
          twf: *tswingleg
          Bc: *rs
          Bm: *ls
          rfabs: *swingLeg3
        -
          twf: *tds
        # 4 step
        -
          twf: *tswingleg
          Bc: *ls
          Bm: *rs
          rfabs: *swingLeg4
        -
          twf: *tds
        -
          twf: 100.
          control method:
            momentum controller: centroidalVrpMomentum
