# @author Sho Miyahara 2018

Controller:
  Control model: skeletonA7SF
  Input: torque
  Driven: mix
  Trigger: check contact

  Default:
    Inverse dynamics controller: fullDynamicsController

    Operational space controller: decomposeEndEffectorAcceleration
    Motion controller: mixedGeneralizedMomentum

    # Force controller: centroidalEcmpDistribution
    # Momentum controller: centroidalDcmMomentum

    Force controller: centroidalDistribution
    Momentum controller: centroidalMomentum

    Torque controller: mixedOpt
    # Torque controller: mixedmixedOpt

    Desired DCM generator: {name: HTWalking}
    Desired base orientation generator: {name: CP}

    Desired control node motion generator:
      RLEGEE: {name: walking}
      LLEGEE: {name: walking}

    KX: 3.e+2
    KpC: 3.e+2
    KdC: 5.e+1
    KpwB: 3.e+2
    KdwB: 5.e+1

    Kpv:
      # RLEGEE: 5.e+3
      # LLEGEE: 5.e+3
      RLEGEE: 5.e+2
      LLEGEE: 5.e+2
    Kdv:
      # RLEGEE: 5.e+2
      # LLEGEE: 5.e+2
      RLEGEE: 5.e+1
      LLEGEE: 5.e+1

    # KDlC: 1.e+1
    # KDth: 1.e+2
    kDth: &kDthH 1.e+2
    # kthHinit: &kthHinit 5.e+0
    KDth:
      [0.,0.,0.,0.,0.,0., 0.,0.,0.,0.,0.,0.,
      *kDthH, *kDthH, *kDthH, *kDthH, *kDthH, *kDthH, *kDthH,
      *kDthH, *kDthH, *kDthH, *kDthH, *kDthH, *kDthH, *kDthH]
    # Kthinit:
    #   - [0.,0.,0.,0.,0.,0.]
    #   - [0.,0.,0.,0.,0.,0.]
    #   - [*kthHinit, *kthHinit, *kthHinit, *kthHinit]
    #   - [*kthHinit, *kthHinit, *kthHinit, *kthHinit]
    Bc: &ds
      RLEGEE: [1, 1, 1, 1, 1, 1]
      LLEGEE: [1, 1, 1, 1, 1, 1]
    Bm: &zs
      RLEGEE: [0, 0, 0, 0, 0, 0]
      LLEGEE: [0, 0, 0, 0, 0, 0]

  State:
    -
      Inverse dynamics controller: default
      Bc: *zs
      Bm: *zs
    -
      Inverse dynamics controller: fullDynamicsController

      Bc: *ds
      Bm: *zs

    -
      Bc: &ls
        RLEGEE: [0, 0, 0, 0, 0, 0]
        LLEGEE: [1, 1, 1, 1, 1, 1]
      Bm: &rs
        RLEGEE: [1, 1, 1, 1, 1, 1]
        LLEGEE: [0, 0, 0, 0, 0, 0]
    -
      Bc: *rs
      Bm: *ls

  Walking:
    stepNum: 10

    # test straight walk
    dtstep: .8
    dtDSstep: 0.4
    alphaDSstep: 0.5
    alphaHTstep: 0.5
    offset: 0.01
    toe: 0.025
    heel: -0.015

    # # dynamic straight walk
    # dtstep: 0.5
    # dtDSstep: 0.1
    # alphaDSstep: 0.5
    # alphaHTstep: 0.5
    # offset: 0.01
    # toe: 0.025
    # heel: -0.015

    # # straight walk toe off
    # dtstep: 0.5
    # dtDSstep: 0.2
    # alphaDSstep: 0.3
    # alphaHTstep: 0.6
    # offset: 0.015
    # toe: 0.025
    # heel: 0.

    # # updown
    # dtstep: 1.
    # dtDSstep: 0.5
    # alphaDSstep: 0.5
    # alphaHTstep: 0.5
    # offset: 0.01
    # toe: 0.025
    # heel: -0.015

    # # rough updown
    # dtstep: 1.
    # dtDSstep: 0.5
    # alphaDSstep: 0.5
    # alphaHTstep: 0.5
    # offset: 0.01
    # toe: 0.025
    # heel: -0.015


    # # updown HT
    # dtstep: 0.8
    # dtDSstep: 0.3
    # alphaDSstep: 0.3
    # alphaHTstep: 0.5
    # offset: 0.01
    # toe: 0.026
    # heel: 0.

  Setting:
    # twf: &tinitial 0.3
    # twf: &tswingleg 0.4
    # twf: &tds 0.1
    twf: &tinitial 0.6
    twf: &tswingleg 0.4
    twf: &tds 0.4

    height: &height 0.02

    length: &steplength1 0.08
    length: &steplength2 0.16
    length: &steplength3 0.24
    length: &steplength4 0.32
    length: &steplength5 0.40
    length: &steplength6 0.48
    length: &steplength7 0.56

    # length: &steplength1 0.09
    # length: &steplength2 0.18
    # length: &steplength3 0.27
    # length: &steplength4 0.36
    # length: &steplength5 0.45
    # length: &steplength6 0.54
    # length: &steplength7 0.63


    # length: &steplength1 0.1
    # length: &steplength2 0.2
    # length: &steplength3 0.3
    # length: &steplength4 0.4
    # length: &steplength5 0.5
    # length: &steplength6 0.6
    # length: &steplength7 0.7

  Footprint:
    cal_Xf: &footPrint1
      LLEGEE: [*steplength1, 0.039, *height, 0., 0., 0.]
    cal_Xf: &footPrint2
      RLEGEE: [*steplength2, -0.039, *height, 0., 0., 0.]
    cal_Xf: &footPrint3
      LLEGEE: [*steplength3, 0.039, *height, 0., 0., 0.]
    cal_Xf: &footPrint4
      RLEGEE: [*steplength4, -0.039, *height, 0., 0., 0.]
    cal_Xf: &footPrint5
      LLEGEE: [*steplength5, 0.039, *height, 0., 0., 0.]
    cal_Xf: &footPrint6
      RLEGEE: [*steplength6, -0.039, *height, 0., 0., 0.]
    cal_Xf: &footPrint7
      LLEGEE: [*steplength7, 0.039, *height, 0., 0., 0.]
    cal_Xf: &footPrint8
      RLEGEE: [*steplength7, -0.039, *height, 0., 0., 0.]
  # ****************************************************************

  Sequence:
    -
      twf: 2.
    # -
    #   twf: *tinitial
    # -
    #   twf: *tswingleg
    #   Bc: *rs
    #   Bm: *ls
    #   cal_Xfabs: *footPrint1
    # -
    #   twf: *tds
    # # 1 step
    # -
    #   twf: *tswingleg
    #   Bc: *ls
    #   Bm: *rs
    #   cal_Xfabs: *footPrint2
    # -
    #   twf: *tds
    # # 2 step
    # -
    #   twf: *tswingleg
    #   Bc: *rs
    #   Bm: *ls
    #   cal_Xfabs: *footPrint3
    # -
    #   twf: *tds
    # # 3 step
    # -
    #   twf: *tswingleg
    #   Bc: *ls
    #   Bm: *rs
    #   cal_Xfabs: *footPrint4
    # -
    #   twf: *tds
    # # 4 step
    # -
    #   twf: *tswingleg
    #   Bc: *rs
    #   Bm: *ls
    #   cal_Xfabs: *footPrint5
    # -
    #   twf: *tds
    # # 5 step
    # -
    #   twf: *tswingleg
    #   Bc: *ls
    #   Bm: *rs
    #   cal_Xfabs: *footPrint6
    # -
    #   twf: *tds
    # # 6 step
    # -
    #   twf: *tswingleg
    #   Bc: *rs
    #   Bm: *ls
    #   cal_Xfabs: *footPrint7
    # -
    #   twf: *tds
    # # 7 step
    # -
    #   twf: *tswingleg
    #   Bc: *ls
    #   Bm: *rs
    #   cal_Xfabs: *footPrint8
    # -
    #   twf: *tds
